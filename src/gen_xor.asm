; THIS IS AN AUTOGENERATED FILE
    ; WARNING: FOR MACOS ONLY
    ; nasm -f macho64 pxor.asm -o pxor.o && ld -o pxor.macho -macosx_version_min 10.7 -e start pxor.o && ./pxor.macho

    BITS 64

    section .text
    global start

    start:
      push   rbp
      mov    rbp, rsp

      ; PRINT OUTPUT
      push   0xa203a
      mov    DWORD [rsp+0x4],0x0
      push   0x76207965
      mov    DWORD [rsp+0x4],0x65756c61
      push   0x7475706e
      mov    DWORD [rsp+0x4],0x6b206120
      push   0x61656c50
      mov    DWORD [rsp+0x4],0x69206573
      mov    rax, 0x2000004
      mov    rdi, 0x1
      mov    rsi, rsp
      mov    edx, 0x1b
      syscall
      pop    rax
      pop    rax
      pop    rax
      pop    rax
      ; GET INPUT
      mov    rax, 0x2000003
      mov    rdi, 0
      lea    rsi, [rel key]
      mov    edx, 0x10
      syscall

      ; CHECK 4 BYTES OF KEY
      xor    rdx, rdx
      mov    rdx, QWORD [rel key]
      shr    rdx, 32
      cmp    edx, 0x4a514f75
      jne    fail

      lea    r15, [rel encrypted]
      lea    r14, [rel key]
      mov    r12, 0 ; i
    loop1:
      cmp    r12, 1098
      jge    exitloop
      mov    eax, 8
      mov    rcx, r12  ;j = i
      mov    r10, rcx  ; store i
      movzx  edx, BYTE [r15+rcx] ; encrypted[i]
      mov    r11d, eax ; store 8
      mov    eax, r10d ; i
      mov    r9d, edx ; encrypted[i]
      cdq
      mov    esi, r11d ; 8
      idiv   esi
      movsxd rcx, edx
      movzx  edx, BYTE [r14+rcx]
      mov    edi, r9d ; encrypted[i]
      xor    edi, edx
      mov    r8b, dil ; product
      mov    rcx, r12
      mov    [r15+rcx], r8b ; encrypted[i] = product
      inc    r12 ; i++
      jmp    loop1
    exitloop:
      mov    edx, DWORD [r15]
      cmp    edx, 0xE5894855
      jne    fail
      mov    eax, 0x2000004 ; write
      mov    rdi, 1         ; std out
      lea    rsi, [rel msg]
      mov    edx, 12
      syscall
      xor    eax, eax
      call   r15
      jmp    final
    fail:
      mov    eax, 0x2000004 ; write
      mov    rdi, 1         ; std out
      lea    rsi, [rel msg2]
      mov    edx, 230
      syscall
      xor    eax, eax
      mov    rax, 0x2000001 ; exit
      mov    rdi, 0
      syscall
    final:
      pop    rbp
      retn

    section .data
      encrypted:
            db 25,2,234,135,29,117,113,64,76,141,39,70,113,79,81,74,76,34,6,27,85,57,150,14,104,78,2,14,0,42,57,36,60,63,23,165,49,107,85,106,45,106,8,10,37,35,52,43,139,14,71,102,6,42,113,35,244,78,99,98,119,240,80,74,76,74,43,235,147,245,74,74,76,74,108,103,45,23,9,18,244,73,99,98,119,240,81,74,76,74,43,239,64,188,80,74,76,240,115,98,117,79,94,79,4,193,118,135,116,79,81,2,141,160,67,227,143,56,5,115,122,63,17,42,248,66,131,75,76,74,43,216,125,79,81,74,76,74,99,98,57,194,84,155,77,74,99,138,14,79,81,74,4,199,110,231,116,79,81,2,246,122,99,98,117,79,81,74,76,6,238,103,1,78,81,74,0,199,110,207,116,79,81,162,148,74,99,98,205,75,81,74,78,245,98,98,117,79,25,199,121,29,98,98,117,7,210,140,68,240,75,98,117,79,94,79,4,193,102,39,116,79,81,2,125,145,43,83,188,7,96,152,4,123,156,63,182,247,85,74,76,72,220,99,117,79,81,2,193,127,5,96,117,79,235,172,76,74,99,109,112,126,145,242,77,74,99,96,202,79,81,74,76,69,102,55,61,198,180,2,125,138,34,217,85,79,81,74,5,243,107,106,125,71,89,66,68,66,42,216,117,78,83,73,72,79,101,101,57,118,137,62,64,7,234,118,181,2,80,128,4,181,163,137,154,7,96,138,1,123,170,47,68,157,28,69,250,86,99,47,116,150,55,3,67,36,160,44,122,249,77,91,1,75,186,47,68,148,20,194,135,7,228,169,58,64,231,86,68,15,235,126,117,41,24,69,50,137,36,234,105,71,24,181,142,7,82,185,57,118,131,7,67,14,176,42,138,143,213,138,57,246,62,161,32,7,216,175,4,123,163,47,68,157,55,3,67,36,161,4,60,64,63,128,4,115,161,22,0,41,24,69,50,136,42,157,183,2,96,145,9,194,176,4,60,64,63,137,3,69,213,118,108,41,24,69,50,129,5,43,122,33,131,7,77,144,46,83,174,10,217,153,42,3,108,12,190,0,94,252,88,83,5,43,122,33,139,44,5,69,29,161,50,199,69,83,42,3,108,28,190,41,24,69,50,152,36,234,97,86,55,3,67,52,184,47,116,149,28,123,151,15,235,177,58,64,231,94,85,6,108,212,105,78,28,123,150,15,235,118,117,7,174,138,167,204,62,161,131,99,35,80,79,211,109,26,200,223,184,34,156,35,84,75,141,93,165,175,156,177,144,28,7,46,40,83,161,14,113,48,128,182,251,94,122,71,124,208,39,36,163,32,150,215,143,94,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,117,79,81,74,76,74,99,98,85,111,113,106,108,12,34,43,57,111,6,2,13,6,38,67,127,69,6,106,108,106,67,66,34,111,113,106,108,106,67,53,85,111,113,106,108,106,67,66,127,24,113,106,108,106,67,66,85,111,6,106,108,29,67,66,85,111,113,29,108,106,67,66,127,111,113,106,108,106,67,66,85,111,113,106,108,106,67,69,91,111,113,29,108,106,67,66,85,111,91,106,108,100,78,64,87,98,127,21,108,106,67,66,85,19,113,22,98,103,78,30,85,111,91,106,99,106,67,66,85,111,113,106,110,103,77,76,42,16,120,106,98,103,68,66,85,111,91,54,108,106,67,66,85,16,113,106,108,106,67,66,85,111,113,101,108,106,67,66,85,111,91,22,107,103,77,61,42,99,113,106,108,100,60,61,91,99,118,106,108,106,67,66,85,111,91,106,44,109,78,79,88,98,118,100,19,22,78,79,82,111,113,106,108,106,67,104,35,25,7,28,26,28,53,52,35,25,7,28,26,28,53,52,35,25,7,28,26,64
          key: times 0x10 db 0
          msg:
            db "Keep going!", 10
          msg2:
            db 32,32,32,32,32,70,65,73,76,32,87,72,65,76,69,33,10,10,87,32,32,32,32,32,87,32,32,32,32,32,32,87,32,32,32,32,32,32,32,32,10,87,32,32,32,32,32,32,32,32,87,32,32,87,32,32,32,32,32,87,32,32,32,32,10,32,32,32,32,32,32,32,32,32,32,32,32,32,32,39,46,32,32,87,32,32,32,32,32,32,10,32,32,46,45,34,34,45,46,95,32,32,32,32,32,92,32,92,46,45,45,124,32,32,10,32,47,32,32,32,32,32,32,32,34,45,46,46,95,95,41,32,46,45,39,32,32,32,10,124,32,32,32,32,32,95,32,32,32,32,32,32,32,32,32,47,32,32,32,32,32,32,10,92,39,45,46,95,95,44,32,32,32,46,95,95,46,44,39,32,32,32,32,32,32,32,10,32,96,39,45,45,45,45,39,46,95,92,45,45,39,32,32,32,32,32,32,10,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,10
        