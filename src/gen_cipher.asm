; THIS IS AN AUTOGENERATED FILE
    ; WARNING: FOR MACOS ONLY
    ; nasm -f macho64 cipher.asm -o cipher.o && ld -o cipher.macho -macosx_version_min 10.7 -e start cipher.o && ./cipher.macho

    BITS 64

    section .text
    global start

    start:
      push   rbp
      mov    rbp,rsp

      ; PRINT OUTPUT
      push   0xa203a
      mov    DWORD [rsp+0x4],0x0
      push   0x76207965
      mov    DWORD [rsp+0x4],0x65756c61
      push   0x7475706e
      mov    DWORD [rsp+0x4],0x6b206120
      push   0x61656c50
      mov    DWORD [rsp+0x4],0x69206573
      mov    rax, 0x2000004
      mov    rdi, 0x1
      mov    rsi, rsp
      mov    edx, 0x1b
      syscall
      pop    rax
      pop    rax
      pop    rax
      pop    rax
      ; GET INPUT
      mov    rax, 0x2000003
      mov    rdi, 0
      lea    rsi, [rel key]
      mov    edx, 0x10
      syscall

    ; GENERATE KEY
      mov    r9, 0                ; int i = 0;
      mov    r10, 0               ; int j = 0;
      lea    r13, [rel encrypted]
      lea    r14, [rel key]
      lea    r15, [rel keyframe]
    loop1:
      cmp    r9, 1656               ; Length of encrypted
      jge    decrypt
      cmp    r10, 4               ; if(j == keyLen)
      jne    not_length
      xor    r10, r10             ; j = 0
      not_length:
      movzx  ecx, BYTE [r14+r10]  ; c = key[j]
      mov    BYTE [r15 + r9], cl  ; newKey[i] = c
      inc    r9                   ; i++
      inc    r10                  ; j++
      jmp    loop1

    decrypt:
      xor    r9, r9               ; int i = 0;
    loop2:
      cmp    r9, 1656               ; Length of encrypted
      jge    exitloop
      movzx  ecx, BYTE [r13+r9]   ; a = encrypted[i]
      movzx  edx, BYTE [r15+r9]   ; b = keyframe[i]
      sub    ecx, edx             ; a - b
      add    ecx, 256             ; a + 256
      mov    rdx, 0
      mov    eax, ecx
      cdq
      mov    esi, 256
      idiv   esi
      mov    BYTE [r13 + r9], dl  ; decryptedMsg[i] = a
      inc    r9                   ; i++
      jmp    loop2

    exitloop:
      mov    edx, DWORD [r13]
      cmp    edx, 0xE5894855
      jne    fail
      mov    eax, 0x2000004 ; write
      mov    rdi, 1         ; std out
      lea    rsi, [rel msg]
      mov    edx, 12
      syscall
      xor    eax, eax
      call   r13
      jmp    final
    fail:
      mov    eax, 0x2000004 ; write
      mov    rdi, 1         ; std out
      lea    rsi, [rel msg2]
      mov    edx, 230
      syscall
      xor    eax, eax
      mov    rax, 0x2000001 ; exit
      mov    rdi, 0
      syscall
    final:
      pop    rbp
      retn

    section .data
      encrypted:
        db 199,120,185,89,218,106,80,126,114,247,116,152,118,48,48,116,114,152,149,237,146,166,247,184,150,52,145,224,231,149,152,226,226,165,164,59,182,84,52,148,211,80,155,220,194,156,149,213,57,116,84,120,229,149,80,221,42,52,48,116,116,239,49,116,114,48,120,253,88,234,75,116,114,48,63,121,202,136,136,204,42,51,48,116,116,239,48,116,114,48,120,1,167,69,53,116,114,234,64,116,114,48,63,121,186,97,2,188,253,69,52,121,114,48,120,53,92,80,177,110,231,127,129,190,129,181,178,116,114,48,124,1,175,211,48,116,114,124,189,169,88,52,48,116,179,236,48,116,114,48,121,245,110,122,52,116,114,173,107,44,122,48,48,116,190,185,17,189,251,250,113,131,40,68,63,181,251,243,116,253,66,113,185,69,11,116,185,82,105,46,120,215,60,113,63,42,134,62,116,253,65,97,7,181,250,40,124,253,83,117,184,120,129,121,47,56,93,236,113,255,137,177,42,201,186,185,21,233,145,232,52,116,114,50,239,117,114,48,48,188,255,101,192,120,114,48,234,128,114,48,48,131,119,97,240,181,113,7,27,154,42,52,48,116,116,239,49,116,114,48,120,1,167,173,52,116,114,234,22,116,114,48,63,121,163,240,232,117,114,48,50,51,114,48,48,116,129,53,141,55,139,50,26,251,143,165,161,180,190,189,87,186,227,127,129,190,190,82,54,143,199,105,198,130,218,126,50,130,114,90,105,152,174,111,71,25,163,155,133,222,159,154,56,126,151,83,100,159,253,62,119,218,120,90,161,151,102,126,147,214,233,32,128,190,190,122,91,95,5,37,122,190,190,122,156,219,159,71,57,134,102,121,147,214,233,32,129,190,190,122,91,99,178,236,128,190,190,32,163,214,231,127,142,195,118,241,166,251,230,127,129,118,255,208,115,87,1,104,53,231,236,111,65,158,106,114,179,191,190,122,91,76,239,127,129,190,190,122,147,214,171,242,132,15,191,122,147,254,128,127,129,190,118,247,158,91,230,127,129,118,104,170,147,214,231,127,129,190,190,54,30,219,115,126,129,190,114,247,158,67,230,127,129,22,6,122,147,214,63,123,129,190,192,37,146,214,231,127,73,59,235,77,146,214,231,55,2,0,182,32,123,214,231,127,142,195,118,241,150,155,230,127,129,118,239,193,91,199,46,55,144,12,118,171,204,179,40,39,133,190,190,120,12,215,231,127,129,118,51,175,53,212,231,127,27,32,190,122,147,225,226,174,193,102,191,122,147,212,60,127,129,190,190,117,150,171,175,246,228,118,239,186,82,77,199,127,129,190,119,35,155,222,239,119,137,182,182,114,90,76,231,126,131,189,186,127,149,217,171,166,185,178,178,55,26,234,39,50,128,244,118,229,211,253,12,55,144,254,115,171,218,163,182,205,76,185,108,134,147,163,230,198,103,119,181,84,208,160,236,41,125,207,115,123,234,163,182,196,68,54,249,55,20,29,172,112,23,202,182,63,27,242,231,89,72,185,164,185,84,94,219,119,72,41,0,55,130,45,171,166,179,123,181,62,224,158,252,191,5,254,171,38,110,21,146,55,8,35,118,171,211,163,182,205,103,119,181,84,209,120,174,112,111,244,118,163,209,138,114,89,72,185,164,184,90,17,41,50,144,5,123,242,224,120,174,112,111,253,117,117,5,234,222,89,72,185,164,177,53,159,236,81,179,123,191,192,94,199,32,58,9,13,156,51,156,128,48,48,142,112,202,131,53,159,236,81,187,160,119,117,77,21,164,247,117,199,156,51,156,144,48,89,72,185,164,200,84,94,211,134,103,119,181,100,232,163,230,197,76,239,9,63,27,37,172,112,23,210,199,54,156,72,219,126,76,239,8,63,27,234,231,55,222,254,25,252,110,21,245,147,83,196,193,3,157,142,58,15,232,150,14,83,132,191,255,141,213,35,14,225,192,144,121,94,88,199,19,62,161,164,242,230,43,210,236,119,172,68,153,84,211,148,8,7,191,210,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,231,127,129,190,190,122,147,214,199,159,161,222,222,60,82,159,171,159,54,118,127,54,86,183,241,117,54,222,222,154,115,182,148,159,161,222,222,154,115,169,199,159,161,222,222,154,115,182,241,72,161,222,222,154,115,182,199,159,54,222,222,77,115,182,199,159,161,145,222,154,115,182,241,159,161,222,222,154,115,182,199,159,161,222,222,154,115,185,205,159,161,145,222,154,115,182,199,159,139,222,222,148,126,180,201,146,175,137,222,154,115,182,199,67,161,138,212,151,126,146,199,159,139,222,213,154,115,182,199,159,161,222,224,151,125,192,156,64,168,222,212,151,116,182,199,159,139,170,222,154,115,182,199,64,161,222,222,154,115,182,199,159,161,217,222,154,115,182,199,159,139,138,221,151,125,177,156,147,161,222,222,148,108,177,205,147,166,222,222,154,115,182,199,159,139,222,158,157,126,195,202,146,166,216,133,70,126,195,196,159,161,222,222,154,115,220,149,73,55,144,140,76,101,168,149,73,55,144,140,76,101,168,149,73,55,144,140,112,48,116,114,48,48,116,114,48,48,116,114,48,48,116,114,48,123,217,215,160,80,219,225,153,158,219,147,58,80,148,146,80,80,186,179,121,124,148,201,120,113,192,183,81,58,126,201,80,80,148,146,80,135,148,146,80,80,148,146,135,80,148,146,80,80,148,146,80,58,203,146,80,80,148,146,80,80,148,201,80,80,203,146,80,80,148,146,135,80,148,146,80,58,148,146,80,80,148,146,80,80,148,146,80,80,148,146,87,94,148,146,135,80,148,146,80,80,148,124,80,80,162,159,82,82,161,160,143,80,148,146,80,80,208,146,140,94,161,159,172,80,148,124,80,95,148,146,80,80,148,146,80,82,161,160,94,143,211,155,80,94,161,153,80,80,148,124,172,80,148,146,80,80,211,146,80,80,148,146,80,80,148,146,95,80,148,146,80,80,148,124,140,87,161,160,143,143,160,146,80,80,162,209,143,94,160,153,80,80,148,146,80,80,148,124,80,144,155,159,93,93,161,153,94,143,208,159,93,87,148,146,80,80,148,146,58,134,202,200,134,134,202,200,134,134,202,200,134,134,202,200,134,134,202,200,134,134,126
      key: times 0x10 db 0
      keyframe: times 1656 db 0
      msg:
        db "Keep going!", 10
      msg2:
        db 32,32,32,32,32,70,65,73,76,32,87,72,65,76,69,33,10,10,87,32,32,32,32,32,87,32,32,32,32,32,32,87,32,32,32,32,32,32,32,32,10,87,32,32,32,32,32,32,32,32,87,32,32,87,32,32,32,32,32,87,32,32,32,32,10,32,32,32,32,32,32,32,32,32,32,32,32,32,32,39,46,32,32,87,32,32,32,32,32,32,10,32,32,46,45,34,34,45,46,95,32,32,32,32,32,92,32,92,46,45,45,124,32,32,10,32,47,32,32,32,32,32,32,32,34,45,46,46,95,95,41,32,46,45,39,32,32,32,10,124,32,32,32,32,32,95,32,32,32,32,32,32,32,32,32,47,32,32,32,32,32,32,10,92,39,45,46,95,95,44,32,32,32,46,95,95,46,44,39,32,32,32,32,32,32,32,10,32,96,39,45,45,45,45,39,46,95,92,45,45,39,32,32,32,32,32,32,10,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,10
    